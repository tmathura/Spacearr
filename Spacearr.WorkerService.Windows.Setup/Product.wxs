<?xml version="1.0" encoding="UTF-8"?>
<?define Name = "Spacearr.WorkerService.Windows" ?>
<?define Manufacturer = "Spacearr" ?>
<?define UpgradeCode = "{56B333FF-84B5-4949-80DF-6D3CFA572075}" ?>
<?define AppSettings.json = "appsettings.json" ?>
<?define FirebaseAdmin.dll = "FirebaseAdmin.dll" ?>
<?define Google.Api.Gax.dll = "Google.Api.Gax.dll" ?>
<?define Google.Api.Gax.Rest.dll = "Google.Api.Gax.Rest.dll" ?>
<?define Google.Apis.Auth.dll = "Google.Apis.Auth.dll" ?>
<?define Google.Apis.Auth.PlatformServices.dll = "Google.Apis.Auth.PlatformServices.dll" ?>
<?define Google.Apis.Core.dll = "Google.Apis.Core.dll" ?>
<?define Google.Apis.dll = "Google.Apis.dll" ?>
<?define Microcharts.dll = "Microcharts.dll" ?>
<?define Microsoft.Bcl.AsyncInterfaces.dll = "Microsoft.Bcl.AsyncInterfaces.dll" ?>
<?define Microsoft.Extensions.Configuration.Abstractions.dll = "Microsoft.Extensions.Configuration.Abstractions.dll" ?>
<?define Microsoft.Extensions.Configuration.Binder.dll = "Microsoft.Extensions.Configuration.Binder.dll" ?>
<?define Microsoft.Extensions.Configuration.CommandLine.dll = "Microsoft.Extensions.Configuration.CommandLine.dll" ?>
<?define Microsoft.Extensions.Configuration.dll = "Microsoft.Extensions.Configuration.dll" ?>
<?define Microsoft.Extensions.Configuration.EnvironmentVariables.dll = "Microsoft.Extensions.Configuration.EnvironmentVariables.dll" ?>
<?define Microsoft.Extensions.Configuration.FileExtensions.dll = "Microsoft.Extensions.Configuration.FileExtensions.dll" ?>
<?define Microsoft.Extensions.Configuration.Json.dll = "Microsoft.Extensions.Configuration.Json.dll" ?>
<?define Microsoft.Extensions.Configuration.UserSecrets.dll = "Microsoft.Extensions.Configuration.UserSecrets.dll" ?>
<?define Microsoft.Extensions.DependencyInjection.Abstractions.dll = "Microsoft.Extensions.DependencyInjection.Abstractions.dll" ?>
<?define Microsoft.Extensions.DependencyInjection.dll = "Microsoft.Extensions.DependencyInjection.dll" ?>
<?define Microsoft.Extensions.FileProviders.Abstractions.dll = "Microsoft.Extensions.FileProviders.Abstractions.dll" ?>
<?define Microsoft.Extensions.FileProviders.Physical.dll = "Microsoft.Extensions.FileProviders.Physical.dll" ?>
<?define Microsoft.Extensions.FileSystemGlobbing.dll = "Microsoft.Extensions.FileSystemGlobbing.dll" ?>
<?define Microsoft.Extensions.Hosting.Abstractions.dll = "Microsoft.Extensions.Hosting.Abstractions.dll" ?>
<?define Microsoft.Extensions.Hosting.dll = "Microsoft.Extensions.Hosting.dll" ?>
<?define Microsoft.Extensions.Hosting.WindowsServices.dll = "Microsoft.Extensions.Hosting.WindowsServices.dll" ?>
<?define Microsoft.Extensions.Logging.Abstractions.dll = "Microsoft.Extensions.Logging.Abstractions.dll" ?>
<?define Microsoft.Extensions.Logging.Configuration.dll = "Microsoft.Extensions.Logging.Configuration.dll" ?>
<?define Microsoft.Extensions.Logging.Console.dll = "Microsoft.Extensions.Logging.Console.dll" ?>
<?define Microsoft.Extensions.Logging.Debug.dll = "Microsoft.Extensions.Logging.Debug.dll" ?>
<?define Microsoft.Extensions.Logging.dll = "Microsoft.Extensions.Logging.dll" ?>
<?define Microsoft.Extensions.Logging.EventLog.dll = "Microsoft.Extensions.Logging.EventLog.dll" ?>
<?define Microsoft.Extensions.Logging.EventSource.dll = "Microsoft.Extensions.Logging.EventSource.dll" ?>
<?define Microsoft.Extensions.Options.ConfigurationExtensions.dll = "Microsoft.Extensions.Options.ConfigurationExtensions.dll" ?>
<?define Microsoft.Extensions.Options.dll = "Microsoft.Extensions.Options.dll" ?>
<?define Microsoft.Extensions.Primitives.dll = "Microsoft.Extensions.Primitives.dll" ?>
<?define Microsoft.Win32.Registry.dll = "Microsoft.Win32.Registry.dll" ?>
<?define Newtonsoft.Json.dll = "Newtonsoft.Json.dll" ?>
<?define PusherClient.dll = "PusherClient.dll" ?>
<?define PusherServer.Core.dll = "PusherServer.Core.dll" ?>
<?define SkiaSharp.dll = "SkiaSharp.dll" ?>
<?define Spacearr.Common.dll = "Spacearr.Common.dll" ?>
<?define Spacearr.Pusher.API.dll = "Spacearr.Pusher.API.dll" ?>
<?define Spacearr.WorkerService.Windows.deps.json = "Spacearr.WorkerService.Windows.deps.json" ?>
<?define Spacearr.WorkerService.Windows.exe = "Spacearr.WorkerService.Windows.exe" ?>
<?define Spacearr.WorkerService.Windows.runtimeconfig.json = "Spacearr.WorkerService.Windows.runtimeconfig.json" ?>
<?define SQLiteNet.dll = "SQLiteNet.dll" ?> <!-- "SQLite-net.dll" does not like the '-' -->
<?define SQLitePCLRaw.batteries_v2.dll = "SQLitePCLRaw.batteries_v2.dll" ?>
<?define SQLitePCLRaw.core.dll = "SQLitePCLRaw.core.dll" ?>
<?define SQLitePCLRaw.nativelibrary.dll = "SQLitePCLRaw.nativelibrary.dll" ?>
<?define SQLitePCLRaw.provider.dynamic_cdecl.dll = "SQLitePCLRaw.provider.dynamic_cdecl.dll" ?>
<?define SuperSocket.ClientEngine.dll = "SuperSocket.ClientEngine.dll" ?>
<?define System.ComponentModel.Annotations.dll = "System.ComponentModel.Annotations.dll" ?>
<?define System.Diagnostics.EventLog.dll = "System.Diagnostics.EventLog.dll" ?>
<?define System.Interactive.Async.dll = "System.Interactive.Async.dll" ?>
<?define System.Runtime.CompilerServices.Unsafe.dll = "System.Runtime.CompilerServices.Unsafe.dll" ?>
<?define System.Security.AccessControl.dll = "System.Security.AccessControl.dll" ?>
<?define System.Security.Principal.Windows.dll = "System.Security.Principal.Windows.dll" ?>
<?define System.ServiceProcess.ServiceController.dll = "System.ServiceProcess.ServiceController.dll" ?>
<?define System.Text.Encodings.Web.dll = "System.Text.Encodings.Web.dll" ?>
<?define System.Text.Json.dll = "System.Text.Json.dll" ?>
<?define WebSocket4Net.dll = "WebSocket4Net.dll" ?>

<?define netcoreapp2.0.System.Diagnostics.EventLog.dll = "netcoreapp2.0.System.Diagnostics.EventLog.dll" ?>
<?define netcoreapp2.0.System.Security.AccessControl.dll = "netcoreapp2.0.System.Security.AccessControl.dll" ?>
<?define netcoreapp2.1.System.Security.Principal.Windows.dll = "netcoreapp2.1.System.Security.Principal.Windows.dll" ?>
<?define netstandard2.0.Microsoft.Win32.Registry.dll = "netstandard2.0.Microsoft.Win32.Registry.dll" ?>
<?define netstandard2.0.System.ServiceProcess.ServiceController.dll = "netstandard2.0.System.ServiceProcess.ServiceController.dll" ?>
<?define e_sqlite3.dll = "e_sqlite3.dll" ?>
<?define x64_e_sqlite3.dll = "x64_e_sqlite3.dll" ?>
<?define libSkiaSharp.dll = "libSkiaSharp.dll" ?>
<?define x86_e_sqlite3.dll = "x86_e_sqlite3.dll" ?>

<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Product Id="*" UpgradeCode="$(var.UpgradeCode)" Version="$(var.VersionNumber)" Language="1033" Name="$(var.Name)" Manufacturer="$(var.Manufacturer)">
    <Package InstallerVersion="300" InstallScope="perMachine" InstallPrivileges="elevated" Compressed="yes" />
    <Media Id="1" Cabinet="Spacearr.WorkerService.Windows.cab" EmbedCab="yes" />

    <!-- Allow upgrades and prevent downgrades -->
    <MajorUpgrade DowngradeErrorMessage="A later version of [ProductName] is already installed. Setup will now exit." AllowSameVersionUpgrades="yes" AllowDowngrades="no" Schedule="afterInstallInitialize" />

    <!-- Define the directory structure -->
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder">
        <Directory Id="ROOTDIRECTORY" Name="$(var.Manufacturer)">
          <Directory Id="INSTALLDIR" Name="$(var.Name)">
            <Directory Id="runtimes" Name="runtimes">
              <Directory Id="win" Name="win">
                <Directory Id="lib" Name="lib">
                  <Directory Id="netcoreapp2.0" Name="netcoreapp2.0" />
                  <Directory Id="netcoreapp2.1" Name="netcoreapp2.1" />
                  <Directory Id="netstandard2.0" Name="netstandard2.0" />
                </Directory>
              </Directory>
              <Directory Id="win_x64" Name="win-x64">
                <Directory Id="native_x64" Name="native" />
              </Directory>
              <Directory Id="win_x86" Name="win-x86">
                <Directory Id="native_x86" Name="native" />
              </Directory>
            </Directory>
          </Directory>
        </Directory>
      </Directory>
    </Directory>
    
    <!-- Show Wix InstallDir step -->
    <UIRef Id="WixUI_InstallDir" />

    <!-- Show the custom Licence Agreement to display during install -->
    <WixVariable Id="WixUILicenseRtf" Value="$(var.Spacearr.WorkerService.Windows.TargetDir)LicenceAgreement.rtf" />

    <!-- Set the InstallDir variable so that it can be passed to the Custom Action -->
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLDIR" />

    <!-- Tell WiX to do the custom action -->
    <InstallExecuteSequence>
      <Custom Action="GetInstallDirectory" Before="ShowUpdateAppSettingsConfigurationAction" />
      <Custom Action='ShowUpdateAppSettingsConfigurationAction' After='InstallFiles'>NOT Installed</Custom>
    </InstallExecuteSequence>

    <!-- Add files to your installer package -->
    <DirectoryRef Id="INSTALLDIR">
      <Component Id="$(var.Spacearr.WorkerService.Windows.TargetFileName)" Guid="{54AAA2B6-C8DE-41D2-93C3-170A780EAB9B}">
        <File Id="$(var.Spacearr.WorkerService.Windows.TargetFileName)" Source="$(var.Spacearr.WorkerService.Windows.TargetPath)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Spacearr.WorkerService.Windows.exe)" Guid="{4161F0EA-5B4A-475D-92B4-97773E9445E0}">
        <File Id="$(var.Spacearr.WorkerService.Windows.exe)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Spacearr.WorkerService.Windows.exe)" KeyPath="yes" />

        <!-- Remove the all files on uninstall -->
        <RemoveFile Id="ROOTDIRECTORY" Name="*.*" On="both" />

        <!-- Tell WiX to install the Service -->
        <ServiceInstall Id="ServiceInstaller" Type="ownProcess" Name="Spacearr.WorkerService.Windows" DisplayName="Spacearr Worker Service Windows" Description="A Windows service for Spacearr." Start="auto" ErrorControl="normal" />

        <!-- Tell WiX to start the Service -->
        <ServiceControl Id="StartService" Start="install" Stop="both" Remove="uninstall" Name="Spacearr.WorkerService.Windows" Wait="yes" />
      </Component>

      <Component Id="$(var.AppSettings.json)" Guid="C5A29C38-40D2-4BBB-BBC1-7E4CDC722388">
        <File Id="$(var.AppSettings.json)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.AppSettings.json)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.FirebaseAdmin.dll)" Guid="F5542469-D5B6-4A9D-9C71-26597D3A3DA4">
        <File Id="$(var.FirebaseAdmin.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.FirebaseAdmin.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Google.Api.Gax.dll)" Guid="0A6A8DAF-6A1B-4EAC-94F0-DCE1F4D87716">
        <File Id="$(var.Google.Api.Gax.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Google.Api.Gax.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Google.Api.Gax.Rest.dll)" Guid="DA07BAB1-BE3D-413F-9C04-D60B4ADBFFAF">
        <File Id="$(var.Google.Api.Gax.Rest.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Google.Api.Gax.Rest.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Google.Apis.Auth.dll)" Guid="093D7AF8-CBC8-4F0F-9A22-17419AEF7AD1">
        <File Id="$(var.Google.Apis.Auth.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Google.Apis.Auth.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Google.Apis.Auth.PlatformServices.dll)" Guid="A7B9BD7C-EEFC-4B57-A97E-88DF2CF947D1">
        <File Id="$(var.Google.Apis.Auth.PlatformServices.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Google.Apis.Auth.PlatformServices.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Google.Apis.Core.dll)" Guid="4D756452-6668-4178-922A-4B08E1ABA246">
        <File Id="$(var.Google.Apis.Core.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Google.Apis.Core.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Google.Apis.dll)" Guid="25250092-DE0E-4A6E-8E8C-906D24EB6872">
        <File Id="$(var.Google.Apis.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Google.Apis.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Microcharts.dll)" Guid="555D273A-69F6-4549-A9D0-FB336F23C0F4">
        <File Id="$(var.Microcharts.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Microcharts.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Microsoft.Bcl.AsyncInterfaces.dll)" Guid="F2F6114B-73E7-45A6-936A-E96454648415">
        <File Id="$(var.Microsoft.Bcl.AsyncInterfaces.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Microsoft.Bcl.AsyncInterfaces.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Microsoft.Extensions.Configuration.Binder.dll)" Guid="0CF754AE-5223-4A4D-A3ED-54517123B113">
        <File Id="$(var.Microsoft.Extensions.Configuration.Binder.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Microsoft.Extensions.Configuration.Binder.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Microsoft.Extensions.Configuration.CommandLine.dll)" Guid="CF6595B1-D288-4A61-91E2-E3EE11176F82">
        <File Id="$(var.Microsoft.Extensions.Configuration.CommandLine.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Microsoft.Extensions.Configuration.CommandLine.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Microsoft.Extensions.Configuration.Abstractions.dll)" Guid="79C2138C-33E6-443B-B3EB-9A876391208A">
        <File Id="$(var.Microsoft.Extensions.Configuration.Abstractions.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Microsoft.Extensions.Configuration.Abstractions.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Microsoft.Extensions.Configuration.dll)" Guid="41E929D0-AABC-4639-B27A-829E34290B14">
        <File Id="$(var.Microsoft.Extensions.Configuration.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Microsoft.Extensions.Configuration.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Microsoft.Extensions.Configuration.EnvironmentVariables.dll)" Guid="20986C2F-9495-4D07-AB1E-83177208969C">
        <File Id="$(var.Microsoft.Extensions.Configuration.EnvironmentVariables.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Microsoft.Extensions.Configuration.EnvironmentVariables.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Microsoft.Extensions.Configuration.FileExtensions.dll)" Guid="D006CA53-0A29-4751-B2A3-54A9458294F6">
        <File Id="$(var.Microsoft.Extensions.Configuration.FileExtensions.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Microsoft.Extensions.Configuration.FileExtensions.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Microsoft.Extensions.Configuration.Json.dll)" Guid="264D5D6C-5939-4BDD-A8CA-5E04FF1C3F08">
        <File Id="$(var.Microsoft.Extensions.Configuration.Json.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Microsoft.Extensions.Configuration.Json.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Microsoft.Extensions.Configuration.UserSecrets.dll)" Guid="8FE77E50-F5DB-46BF-81CF-6D299E896E3A">
        <File Id="$(var.Microsoft.Extensions.Configuration.UserSecrets.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Microsoft.Extensions.Configuration.UserSecrets.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Microsoft.Extensions.DependencyInjection.Abstractions.dll)" Guid="EDB12F3E-3D8E-462E-8917-87B6332D134F">
        <File Id="$(var.Microsoft.Extensions.DependencyInjection.Abstractions.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Microsoft.Extensions.DependencyInjection.Abstractions.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Microsoft.Extensions.DependencyInjection.dll)" Guid="26D7595E-544C-48D2-8742-403FB024F887">
        <File Id="$(var.Microsoft.Extensions.DependencyInjection.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Microsoft.Extensions.DependencyInjection.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Microsoft.Extensions.FileProviders.Abstractions.dll)" Guid="61CF0184-1E77-43D0-9594-00690D909B9A">
        <File Id="$(var.Microsoft.Extensions.FileProviders.Abstractions.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Microsoft.Extensions.FileProviders.Abstractions.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Microsoft.Extensions.FileProviders.Physical.dll)" Guid="97DA0CF3-5D25-4A39-B55C-E61D9F76CBD4">
        <File Id="$(var.Microsoft.Extensions.FileProviders.Physical.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Microsoft.Extensions.FileProviders.Physical.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Microsoft.Extensions.FileSystemGlobbing.dll)" Guid="4F0D75F3-C16F-4F3D-9A51-AA32E133A53E">
        <File Id="$(var.Microsoft.Extensions.FileSystemGlobbing.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Microsoft.Extensions.FileSystemGlobbing.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Microsoft.Extensions.Hosting.Abstractions.dll)" Guid="4CBE5B46-8B73-40C2-9DF9-91D986A9E792">
        <File Id="$(var.Microsoft.Extensions.Hosting.Abstractions.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Microsoft.Extensions.Hosting.Abstractions.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Microsoft.Extensions.Hosting.dll)" Guid="95D4A5B8-D7A5-4F83-8B53-29D430E2D59A">
        <File Id="$(var.Microsoft.Extensions.Hosting.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Microsoft.Extensions.Hosting.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Microsoft.Extensions.Hosting.WindowsServices.dll)" Guid="2BAFB754-DC4B-4A5D-A701-E755AD77A959">
        <File Id="$(var.Microsoft.Extensions.Hosting.WindowsServices.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Microsoft.Extensions.Hosting.WindowsServices.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Microsoft.Extensions.Logging.Abstractions.dll)" Guid="E3A1CBBF-A6C2-43D8-9A29-BA24FF87168B">
        <File Id="$(var.Microsoft.Extensions.Logging.Abstractions.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Microsoft.Extensions.Logging.Abstractions.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Microsoft.Extensions.Logging.Configuration.dll)" Guid="FDF91EB5-A371-4A61-983A-924A9058D86A">
        <File Id="$(var.Microsoft.Extensions.Logging.Configuration.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Microsoft.Extensions.Logging.Configuration.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Microsoft.Extensions.Logging.Console.dll)" Guid="AFCF44FB-4353-4D67-BE5A-F129B61F56D1">
        <File Id="$(var.Microsoft.Extensions.Logging.Console.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Microsoft.Extensions.Logging.Console.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Microsoft.Extensions.Logging.Debug.dll)" Guid="8D2C3B1A-9AA7-40AF-85B4-7A4CFCE9D92F">
        <File Id="$(var.Microsoft.Extensions.Logging.Debug.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Microsoft.Extensions.Logging.Debug.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Microsoft.Extensions.Logging.dll)" Guid="1B4617CB-B640-4C6C-B55D-8EABFF4BE12C">
        <File Id="$(var.Microsoft.Extensions.Logging.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Microsoft.Extensions.Logging.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Microsoft.Extensions.Logging.EventLog.dll)" Guid="9F4DAA81-F629-47C8-B681-35867B2002E1">
        <File Id="$(var.Microsoft.Extensions.Logging.EventLog.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Microsoft.Extensions.Logging.EventLog.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Microsoft.Extensions.Logging.EventSource.dll)" Guid="E474F805-811A-4E27-8026-3173BE7466CA">
        <File Id="$(var.Microsoft.Extensions.Logging.EventSource.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Microsoft.Extensions.Logging.EventSource.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Microsoft.Extensions.Options.ConfigurationExtensions.dll)" Guid="2FF74087-8A02-45C1-B54F-33CED1F96E2C">
        <File Id="$(var.Microsoft.Extensions.Options.ConfigurationExtensions.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Microsoft.Extensions.Options.ConfigurationExtensions.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Microsoft.Extensions.Options.dll)" Guid="123211E0-4856-4CAE-ABF6-9E113D993EE4">
        <File Id="$(var.Microsoft.Extensions.Options.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Microsoft.Extensions.Options.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Microsoft.Extensions.Primitives.dll)" Guid="5D27BE00-1CCD-45A7-90E6-845B98C0D7FC">
        <File Id="$(var.Microsoft.Extensions.Primitives.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Microsoft.Extensions.Primitives.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Microsoft.Win32.Registry.dll)" Guid="D57D2349-952A-4BF4-BEE3-4B2010FF2ED9">
        <File Id="$(var.Microsoft.Win32.Registry.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Microsoft.Win32.Registry.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Newtonsoft.Json.dll)" Guid="3A35BEBC-84A2-4B1D-945D-E1AA4CC7A6C8">
        <File Id="$(var.Newtonsoft.Json.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Newtonsoft.Json.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.PusherClient.dll)" Guid="39A2E9EA-3C11-46EE-A9AE-0B8752447117">
        <File Id="$(var.PusherClient.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.PusherClient.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.PusherServer.Core.dll)" Guid="3CFD5E91-18CC-4CAB-8573-A48603400FC7">
        <File Id="$(var.PusherServer.Core.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.PusherServer.Core.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.SkiaSharp.dll)" Guid="4CEACE17-89F6-403F-A1F4-30CF4310408A">
        <File Id="$(var.SkiaSharp.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.SkiaSharp.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Spacearr.Common.dll)" Guid="3BC582F5-2934-4A79-9C20-CDBF00D49490">
        <File Id="$(var.Spacearr.Common.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Spacearr.Common.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Spacearr.Pusher.API.dll)" Guid="EB44F4CB-78F5-438B-9FD0-D9E2FF80D956">
        <File Id="$(var.Spacearr.Pusher.API.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Spacearr.Pusher.API.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Spacearr.WorkerService.Windows.deps.json)" Guid="507A649C-D586-46C8-A947-B326D8D34C94">
        <File Id="$(var.Spacearr.WorkerService.Windows.deps.json)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Spacearr.WorkerService.Windows.deps.json)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.Spacearr.WorkerService.Windows.runtimeconfig.json)" Guid="11B173D0-AB08-4139-B321-65909776AAAF">
        <File Id="$(var.Spacearr.WorkerService.Windows.runtimeconfig.json)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.Spacearr.WorkerService.Windows.runtimeconfig.json)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.SQLiteNet.dll)" Guid="EB585D7B-2AB4-4ABB-973D-B184A689663D">
        <File Id="$(var.SQLiteNet.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)SQLite-net.dll" KeyPath="yes" /> <!-- "SQLite-net.dll" manually specified because it does not like the '-' -->
      </Component>
      <Component Id="$(var.SQLitePCLRaw.batteries_v2.dll)" Guid="E72D3E8A-9DEE-4A4F-8937-71CB960950FC">
        <File Id="$(var.SQLitePCLRaw.batteries_v2.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.SQLitePCLRaw.batteries_v2.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.SQLitePCLRaw.core.dll)" Guid="26C2B0F1-4D14-405C-BF90-7806AD05785E">
        <File Id="$(var.SQLitePCLRaw.core.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.SQLitePCLRaw.core.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.SQLitePCLRaw.nativelibrary.dll)" Guid="17F618DC-30DF-48BC-A143-50799F08A22A">
        <File Id="$(var.SQLitePCLRaw.nativelibrary.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.SQLitePCLRaw.nativelibrary.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.SQLitePCLRaw.provider.dynamic_cdecl.dll)" Guid="1B14AB68-5BBD-4F7C-8FC7-B96EBDDA832D">
        <File Id="$(var.SQLitePCLRaw.provider.dynamic_cdecl.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.SQLitePCLRaw.provider.dynamic_cdecl.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.SuperSocket.ClientEngine.dll)" Guid="39D115D6-4C5E-4D1E-88D6-86DC8CA5CB10">
        <File Id="$(var.SuperSocket.ClientEngine.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.SuperSocket.ClientEngine.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.System.ComponentModel.Annotations.dll)" Guid="CD1110F7-2954-433C-B917-A36CE52CA476">
        <File Id="$(var.System.ComponentModel.Annotations.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.System.ComponentModel.Annotations.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.System.Diagnostics.EventLog.dll)" Guid="F126BF50-FC06-47D9-9654-153957E336E5">
        <File Id="$(var.System.Diagnostics.EventLog.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.System.Diagnostics.EventLog.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.System.Interactive.Async.dll)" Guid="8E258946-55CA-48B8-94FF-206D77150D94">
        <File Id="$(var.System.Interactive.Async.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.System.Interactive.Async.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.System.Runtime.CompilerServices.Unsafe.dll)" Guid="612CF274-4CA3-4555-B046-E7209390DC2C">
        <File Id="$(var.System.Runtime.CompilerServices.Unsafe.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.System.Runtime.CompilerServices.Unsafe.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.System.Security.AccessControl.dll)" Guid="51913579-D697-41BE-8B9F-5A075B7811A4">
        <File Id="$(var.System.Security.AccessControl.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.System.Security.AccessControl.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.System.Security.Principal.Windows.dll)" Guid="B7518103-C74B-4E3D-9B35-03262519ABD4">
        <File Id="$(var.System.Security.Principal.Windows.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.System.Security.Principal.Windows.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.System.ServiceProcess.ServiceController.dll)" Guid="EFE79782-8DF1-4EBE-9FF2-55B3DE99D173">
        <File Id="$(var.System.ServiceProcess.ServiceController.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.System.ServiceProcess.ServiceController.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.System.Text.Encodings.Web.dll)" Guid="8D4175F9-A1E4-439B-96C4-F1B5B6CDC919">
        <File Id="$(var.System.Text.Encodings.Web.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.System.Text.Encodings.Web.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.System.Text.Json.dll)" Guid="F332C35B-41AA-40DF-8387-44446046EE7D">
        <File Id="$(var.System.Text.Json.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.System.Text.Json.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.WebSocket4Net.dll)" Guid="7C4B679B-DA2F-41C9-8C84-918C6169A2B0">
        <File Id="$(var.WebSocket4Net.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)$(var.WebSocket4Net.dll)" KeyPath="yes" />
      </Component>
    </DirectoryRef>
    <DirectoryRef Id="netcoreapp2.0">
      <Component Id="$(var.netcoreapp2.0.System.Diagnostics.EventLog.dll)" Guid="104AE3EF-6894-4564-AF68-9DF3263DB94D">
        <File Id="$(var.netcoreapp2.0.System.Diagnostics.EventLog.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)runtimes\win\lib\netcoreapp2.0\$(var.System.Diagnostics.EventLog.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.netcoreapp2.0.System.Security.AccessControl.dll)" Guid="6C702BA2-9583-463A-8784-7CDFAA18B97A">
        <File Id="$(var.netcoreapp2.0.System.Security.AccessControl.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)runtimes\win\lib\netcoreapp2.0\$(var.System.Security.AccessControl.dll)" KeyPath="yes" />
      </Component>
    </DirectoryRef>
    <DirectoryRef Id="netcoreapp2.1">
      <Component Id="$(var.netcoreapp2.1.System.Security.Principal.Windows.dll)" Guid="CB2C1612-F931-4C72-A17E-2F6005B2EF9E">
        <File Id="$(var.netcoreapp2.1.System.Security.Principal.Windows.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)runtimes\win\lib\netcoreapp2.1\$(var.System.Security.Principal.Windows.dll)" KeyPath="yes" />
      </Component>
    </DirectoryRef>
    <DirectoryRef Id="netstandard2.0">
      <Component Id="$(var.netstandard2.0.Microsoft.Win32.Registry.dll)" Guid="C0A3FDEA-73C2-47A3-99CF-0D1CF3BAF5C7">
        <File Id="$(var.netstandard2.0.Microsoft.Win32.Registry.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)runtimes\win\lib\netstandard2.0\$(var.Microsoft.Win32.Registry.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.netstandard2.0.System.ServiceProcess.ServiceController.dll)" Guid="EE1C7896-C143-459D-B262-F604BE1549E2">
        <File Id="$(var.netstandard2.0.System.ServiceProcess.ServiceController.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)runtimes\win\lib\netstandard2.0\$(var.System.ServiceProcess.ServiceController.dll)" KeyPath="yes" />
      </Component>
    </DirectoryRef>
    <DirectoryRef Id="native_x64">
      <Component Id="$(var.x64_e_sqlite3.dll)" Guid="E94B56E0-27CD-484B-8E98-4FCFB0A2060E">
        <File Id="$(var.x64_e_sqlite3.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)runtimes\win-x64\native\$(var.e_sqlite3.dll)" KeyPath="yes" />
      </Component>
      <Component Id="$(var.libSkiaSharp.dll)" Guid="23B4E205-D4EA-4B50-BBFF-FCE41F62CDC6">
        <File Id="$(var.libSkiaSharp.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)runtimes\win-x64\native\$(var.libSkiaSharp.dll)" KeyPath="yes" />
      </Component>
    </DirectoryRef>
    <DirectoryRef Id="native_x86">
      <Component Id="$(var.x86_e_sqlite3.dll)" Guid="4394A5E7-C81B-40C6-B7FE-5ECDCC2504BF">
        <File Id="$(var.x86_e_sqlite3.dll)" Source="$(var.Spacearr.WorkerService.Windows.TargetDir)runtimes\win-x86\native\$(var.e_sqlite3.dll)" KeyPath="yes" />
      </Component>
    </DirectoryRef>

    <!-- Tell WiX to install the files -->
    <Feature Id="MainApplication" Title="Spacearr Windows Service" Level="1">
      <ComponentRef Id="$(var.Spacearr.WorkerService.Windows.TargetFileName)" />
      <ComponentRef Id="$(var.AppSettings.json)" />
      <ComponentRef Id="$(var.FirebaseAdmin.dll)" />
      <ComponentRef Id="$(var.Google.Api.Gax.dll)" />
      <ComponentRef Id="$(var.Google.Api.Gax.Rest.dll)" />
      <ComponentRef Id="$(var.Google.Apis.Auth.dll)" />
      <ComponentRef Id="$(var.Google.Apis.Auth.PlatformServices.dll)" />
      <ComponentRef Id="$(var.Google.Apis.Core.dll)" />
      <ComponentRef Id="$(var.Google.Apis.dll)" />
      <ComponentRef Id="$(var.Microcharts.dll)" />
      <ComponentRef Id="$(var.Microsoft.Bcl.AsyncInterfaces.dll)" />
      <ComponentRef Id="$(var.Microsoft.Extensions.Configuration.Abstractions.dll)" />
      <ComponentRef Id="$(var.Microsoft.Extensions.Configuration.Binder.dll)" />
      <ComponentRef Id="$(var.Microsoft.Extensions.Configuration.CommandLine.dll)" />
      <ComponentRef Id="$(var.Microsoft.Extensions.Configuration.dll)" />
      <ComponentRef Id="$(var.Microsoft.Extensions.Configuration.EnvironmentVariables.dll)" />
      <ComponentRef Id="$(var.Microsoft.Extensions.Configuration.FileExtensions.dll)" />
      <ComponentRef Id="$(var.Microsoft.Extensions.Configuration.Json.dll)" />
      <ComponentRef Id="$(var.Microsoft.Extensions.Configuration.UserSecrets.dll)" />
      <ComponentRef Id="$(var.Microsoft.Extensions.DependencyInjection.Abstractions.dll)" />
      <ComponentRef Id="$(var.Microsoft.Extensions.DependencyInjection.dll)" />
      <ComponentRef Id="$(var.Microsoft.Extensions.FileProviders.Abstractions.dll)" />
      <ComponentRef Id="$(var.Microsoft.Extensions.FileProviders.Physical.dll)" />
      <ComponentRef Id="$(var.Microsoft.Extensions.FileSystemGlobbing.dll)" />
      <ComponentRef Id="$(var.Microsoft.Extensions.Hosting.Abstractions.dll)" />
      <ComponentRef Id="$(var.Microsoft.Extensions.Hosting.dll)" />
      <ComponentRef Id="$(var.Microsoft.Extensions.Hosting.WindowsServices.dll)" />
      <ComponentRef Id="$(var.Microsoft.Extensions.Logging.Abstractions.dll)" />
      <ComponentRef Id="$(var.Microsoft.Extensions.Logging.Configuration.dll)" />
      <ComponentRef Id="$(var.Microsoft.Extensions.Logging.Console.dll)" />
      <ComponentRef Id="$(var.Microsoft.Extensions.Logging.Debug.dll)" />
      <ComponentRef Id="$(var.Microsoft.Extensions.Logging.dll)" />
      <ComponentRef Id="$(var.Microsoft.Extensions.Logging.EventLog.dll)" />
      <ComponentRef Id="$(var.Microsoft.Extensions.Logging.EventSource.dll)" />
      <ComponentRef Id="$(var.Microsoft.Extensions.Options.ConfigurationExtensions.dll)" />
      <ComponentRef Id="$(var.Microsoft.Extensions.Options.dll)" />
      <ComponentRef Id="$(var.Microsoft.Extensions.Primitives.dll)" />
      <ComponentRef Id="$(var.Microsoft.Win32.Registry.dll)" />
      <ComponentRef Id="$(var.Newtonsoft.Json.dll)" />
      <ComponentRef Id="$(var.PusherClient.dll)" />
      <ComponentRef Id="$(var.PusherServer.Core.dll)" />
      <ComponentRef Id="$(var.SkiaSharp.dll)" />
      <ComponentRef Id="$(var.Spacearr.Common.dll)" />
      <ComponentRef Id="$(var.Spacearr.Pusher.API.dll)" />
      <ComponentRef Id="$(var.Spacearr.WorkerService.Windows.deps.json)" />
      <ComponentRef Id="$(var.Spacearr.WorkerService.Windows.exe)" />
      <ComponentRef Id="$(var.Spacearr.WorkerService.Windows.runtimeconfig.json)" />
      <ComponentRef Id="$(var.SQLiteNet.dll)" />
      <ComponentRef Id="$(var.SQLitePCLRaw.batteries_v2.dll)" />
      <ComponentRef Id="$(var.SQLitePCLRaw.core.dll)" />
      <ComponentRef Id="$(var.SQLitePCLRaw.nativelibrary.dll)" />
      <ComponentRef Id="$(var.SQLitePCLRaw.provider.dynamic_cdecl.dll)" />
      <ComponentRef Id="$(var.SuperSocket.ClientEngine.dll)" />
      <ComponentRef Id="$(var.System.ComponentModel.Annotations.dll)" />
      <ComponentRef Id="$(var.System.Diagnostics.EventLog.dll)" />
      <ComponentRef Id="$(var.System.Interactive.Async.dll)" />
      <ComponentRef Id="$(var.System.Runtime.CompilerServices.Unsafe.dll)" />
      <ComponentRef Id="$(var.System.Security.AccessControl.dll)" />
      <ComponentRef Id="$(var.System.Security.Principal.Windows.dll)" />
      <ComponentRef Id="$(var.System.ServiceProcess.ServiceController.dll)" />
      <ComponentRef Id="$(var.System.Text.Encodings.Web.dll)" />
      <ComponentRef Id="$(var.System.Text.Json.dll)" />
      <ComponentRef Id="$(var.WebSocket4Net.dll)" />

      <ComponentRef Id = "netcoreapp2.0.System.Diagnostics.EventLog.dll" />
      <ComponentRef Id = "netcoreapp2.0.System.Security.AccessControl.dll" />
      <ComponentRef Id = "netcoreapp2.1.System.Security.Principal.Windows.dll" />
      <ComponentRef Id = "netstandard2.0.Microsoft.Win32.Registry.dll" />
      <ComponentRef Id = "netstandard2.0.System.ServiceProcess.ServiceController.dll" />
      <ComponentRef Id="$(var.x64_e_sqlite3.dll)" />
      <ComponentRef Id="$(var.libSkiaSharp.dll)" />
      <ComponentRef Id="$(var.x86_e_sqlite3.dll)" />
    </Feature>
    <Property Id="ARPPRODUCTICON" Value="icon.ico" />
  </Product>

  <!-- Set up the Custom Action -->
  <Fragment>
    <Binary Id="CustomActionBinary" SourceFile="$(var.Spacearr.WixToolset.CustomAction.TargetDir)$(var.Spacearr.WixToolset.CustomAction.TargetName).CA.dll"/>
    <CustomAction Id="GetInstallDirectory" Property="ShowUpdateAppSettingsConfigurationAction" Value="InstallDirectory=[INSTALLDIR]"/>
    <CustomAction Id="ShowUpdateAppSettingsConfigurationAction" BinaryKey="CustomActionBinary" DllEntry="ShowUpdateAppSettingsConfigurationScreens" Execute="deferred" Return="check" Impersonate="no"/>
  </Fragment>
</Wix>